<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name="description" content="">
<title>{pigcms:$Guajiang.title}</title>
<link href="{pigcms::RES}/css/guajiang/css/activity-style.css" rel="stylesheet" type="text/css">

<style type="text/css">
body{
	word-wrap: break-word;
}
#txt {
	color: #000000;
}
.footFix{width:100%;text-align:center;position:fixed;left:0;bottom:0;z-index:99;}
#footReturn a, #footReturn2 a {
display: block;
line-height: 41px;
color: #fff;
text-shadow: 1px 1px #282828;
font-size: 14px;
font-weight: bold;
}
#footReturn, #footReturn2 {
z-index: 89;
display: inline-block;
text-align: center;
text-decoration: none;
vertical-align: middle;
cursor: pointer;
width: 100%;
outline: 0 none;
overflow: visible;
Unknown property name.-moz-box-sizing: border-box;
box-sizing: border-box;
padding: 0;
height: 41px;
opacity: .95;
border-top: 1px solid #181818;
box-shadow: inset 0 1px 2px #b6b6b6;
background-color: #515151;
Invalid property value.background-image: -ms-linear-gradient(top,#838383,#202020);
background-image: -webkit-linear-gradient(top,#838383,#202020);
Invalid property value.background-image: -moz-linear-gradient(top,#838383,#202020);
Invalid property value.background-image: -o-linear-gradient(top,#838383,#202020);
background-image: -webkit-gradient(linear,0% 0,0% 100%,from(#838383),to(#202020));
Invalid property value.filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#838383',endColorstr='#202020');
Unknown property name.-ms-filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#838383',endColorstr='#202020');
}

</style>
<script type="text/javascript">
if (typeof WeixinJSBridge== 'undefined'){
	//window.location.href='/alert.html';
}else{
	
}
function loading(canvas,options){   
  this.canvas = canvas;   
  if(options){   
    this.radius = options.radius||12;   
    this.circleLineWidth = options.circleLineWidth||4;   
    this.circleColor = options.circleColor||'lightgray';   
    this.moveArcColor = options.moveArcColor||'gray';   
  }else{   
    this.radius = 12;   
    this.circelLineWidth = 4;   
    this.circleColor = 'lightgray';   
    this.moveArcColor = 'gray';   
  }   
}   
loading.prototype = {   
  show:function (){   
    var canvas = this.canvas;   
    if(!canvas.getContext)return;   
    if(canvas.__loading)return;   
    canvas.__loading = this;   
    var ctx = canvas.getContext('2d');   
    var radius = this.radius;   
    var me = this;   
    var rotatorAngle = Math.PI*1.5;   
    var step = Math.PI/6;   
    canvas.loadingInterval = setInterval(function(){   
      ctx.clearRect(0,0,canvas.width,canvas.height);   
      var lineWidth = me.circleLineWidth;   
      var center = {x:canvas.width/2,y:canvas.height/2};  

      ctx.beginPath();   
      ctx.lineWidth = lineWidth;   
      ctx.strokeStyle = me.circleColor;   
      ctx.arc(center.x,center.y+20,radius,0,Math.PI*2);   
      ctx.closePath();   
      ctx.stroke();   
      //在圆圈上面画小圆   
      ctx.beginPath();   
      ctx.strokeStyle = me.moveArcColor;   
      ctx.arc(center.x,center.y+20,radius,rotatorAngle,rotatorAngle+Math.PI*.45);   
      ctx.stroke();   
      rotatorAngle+=step;   
 
    },100);   
  },   
  hide:function(){   
    var canvas = this.canvas;   
    canvas.__loading = false;   
    if(canvas.loadingInterval){   
      window.clearInterval(canvas.loadingInterval);   
    }   
    var ctx = canvas.getContext('2d');   
    if(ctx)ctx.clearRect(0,0,canvas.width,canvas.height);   
  }   
};   
</script>
<script   src="{pigcms::RES}/css/guajiang/js/jquery.js" type="text/javascript"></script>
<script src="{pigcms::RES}/css/guajiang/js/wScratchPad.js"></script>
</head>




<body data-role="page" class="activity-scratch-card-winning">
  <script type="text/javascript">
// var loadingObj = new loading(document.getElementById('loading'),{radius:20,circleLineWidth:8});   
//     loadingObj.show();   

</script>

<if condition="$Guajiang['islottery'] eq '1'">
<div class="main">
		<div class="content" style="margin-top:-5px">
			<div class="boxcontent boxwhite">
				<div class="box">
					<div class="title-brown">恭喜：</div>
					<div class="Detail">
					
					<p>您已经中过 <strong><font color='red'>{pigcms:$Guajiang.winprize}</font></strong> 奖了,<br />
					<notempty name="Guajiang.sncode">您的领奖序列号:<font color='red'> {pigcms:$Guajiang.sncode} </font>请您牢记及尽快与我们联系<else/><input type="button" value="点击提交联系信息" onclick="$('#zjl').slideToggle(500);"/></notempty>
					</p>	
			
					</div>
				</div>
			</div>
		</div>
	</div>
</if>
<if condition="$Guajiang['end'] eq '1'">
	<div class="main">
		<div class="banner"><img src="{pigcms::RES}/css/guajiang/images/activity-scratch-card-end2.jpg"></div>
		<div class="content" style="margin-top:-5px">
			<div class="boxcontent boxwhite">
				<div class="box">
					<div class="title-brown">活动结束说明：</div>
					<div class="Detail">
						<p>{pigcms:$Guajiang.endinfo}.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
<else/>
	<div class="main">
	<?php if($Guajiang['islottery']!='1'): ?>
	<div class="cover">
		<img src="{pigcms::RES}/css/guajiang/images/activity-scratch-card-bannerbg.png">
		<div id="prize"> {pigcms:$Guajiang.winprize|default="谢谢惠顾"}</div>
		<div id="scratchpad" style="text-align:left;"></div>
		
	</div>
	<?php endif;?>
<div class="content">
	   
	<div id="zjl" style="display:none" class="boxcontent boxwhite">
		<div class="box">
			<div class="title-red"><span>恭喜你中奖了</span></div>
			<div class="Detail">
				<p>您中了：<span class="red">{pigcms:$Guajiang.winprize}</span></p>
				<p class="red"> {pigcms:$Guajiang.sttxt} </p>
				<form method="post" id="formdata" action="{pigcms::U('add')}">
				<input name="wechaid"  id="wechaid" value="{pigcms:$wecha_id}" type="hidden">
	            <input name="lid"  id="lid" value="{pigcms:$Guajiang.id}" type="hidden">
	            <input name="winprize"  id="winprize" value="" type="hidden">
	            <?php if(!empty($Guajiang['formset'])): ?>
	                <?php foreach($Guajiang['formset'] as $field): ?>
	                    <?php if($field['type']=='selectfield'): ?>
	                        <?php $options = explode(",",$field['value']);?>
	                        <div>
	                            {pigcms:$field.name}:
	                            <select name="formdata[{pigcms:$field.id}]" required>
	                                <?php foreach($options as $option):?>
	                                <option value="{pigcms:$option}">{pigcms:$option}</option>
	                                <?php endforeach;?>
	                            </select>
	                        </div>
	                    <?php else: ?>
	                        <div>
	                        {pigcms:$field.name}:<input type="text" name="formdata[{pigcms:$field.id}]" placeholder="{pigcms:$field.name}" value="{pigcms:$field.value}" required />
	                        </div>
	                    <?php endif;?>
	                <?php endforeach;?>
	            <?php else: ?>
				<p>
					<input name="phone"  class="px" id="phone" value="" type="text" placeholder="请输入您的手机号">
					<input name="myname"  class="px" id="myname" value="" type="text" placeholder="请输入您的姓名">
					<input name="idnumber"  class="px" id="idnumber" value="" type="text" placeholder="请输入您的身份证号">
					
				</p>
				<?php endif; ?>
				<p>
					<input class="pxbtn" name="提 交"  type="submit" value="用户提交">
				</p>
				</form>
			</div>
		</div>
	</div>
	<div id="tryagain" style="display:none">
		<input type="button" class="pxbtn" style="margin:auto;width:90%;height:50px;" value="再来一次" onclick="window.location.href=window.location.href" />
	</div>
	<div class="boxcontent boxwhite">
		<div class="box">
			<div class="title-brown"><span>奖项说明：</span></div>
			<div class="Detail">
			<p class="red">打开不刮奖视为作废</p>
			<p>你还有{pigcms:$Guajiang.usenums}次机会</p>
			<p>这是您第 <span class="red" id="usenums">{pigcms:$Guajiang.counts}</span> 次刮奖</p>
			 {pigcms::$prizeStr}

			</div>

		</div>
	</div>
	<div class="boxcontent boxwhite">
		<div class="box">
			<div class="title-brown">活动说明：</div>
			<div class="Detail">{pigcms:$Guajiang.info|htmlspecialchars_decode}
				<p>活动时间:{pigcms:$Guajiang.statdate|date="Y-m-d",###}至{pigcms:$Guajiang.enddate|date="Y-m-d",###}</p>
				<p>{pigcms:$Guajiang.txt}</p>				
							
			</div>
		</div>
	</div>
</div>
<div style="clear:both;"></div>
</div>	
</if>	

<script src="{pigcms::RES}/css/guajiang/js/alert.js" type="text/javascript"></script>

<div class="window" id="windowcenter">
	<div id="title" class="title">消息提醒<span class="close" id="alertclose"></span></div>
	<div class="content">
	 <div id="txt"></div>
	 <input type="button" value="确定" id="windowclosebutton" name="确定" class="txtbtn">	
	</div>
</div>
 
 

<script type="text/javascript">
/*window.sncode = "{pigcms:$Guajiang.sn}";*/
window.prize = "{pigcms:$Guajiang.winprize}";
var winprize  = "{pigcms:$Guajiang.winprize}";
var zjl = "{pigcms:$Guajiang.zjl}";
var num = 0;
var goon = true;
$(function(){
	$("#scratchpad").wScratchPad({
		width : 150,
		height : 40,
		color: '#a9a9a7',
		bg: '',  // Background (image path or hex color).
  		fg: '#a9a9a7',  // Foreground (image path or hex color).
  		realtimePercent:true,
		scratchMove : function(e, percent){
			//$("#prize").html("hello");
			if(percent > 20){
                this.clear();
                
				if(zjl==0&&goon){ //不中奖[谢谢参与]
					$("#tryagain").show()
					goon = false;
					document.getElementById('txt').innerHTML="{pigcms:$Guajiang.winprize}";
					$("#windowcenter").slideToggle(500);
				}
				
				if(zjl&&goon){
					//$("#zjl").fadeIn();
					goon = false;
					$("#zjl").slideToggle(500);
					//$("#outercont").slideUp(500)
				}
			}
			
		}
	});


});

// $("#save-btn").bind("click",
// 	function() {
// 		var btn 	= $(this);
// 		var tel 	= $("#tel").val();
// 		var myname	= $("#myname").val();
// 		var wechaid = $("#wechaid").val();
// 		var lid 	= $("#lid").val();
// 		var idnumber = $("#idnumber").val();
// 		if (tel == '') {
// 	        alert("请输入手机号");
// 	        return
// 	    }
	    
// 	    if (myname == '') {
// 	        alert("请输入姓名");
// 	        return
// 	    }
	    
// 	    if(idnumber == ""){
// 	        alert("请输入身份证号");
// 	        return
// 	    }
// 	    if(!lid){
// 	    	alert('lid missed');
// 	    	return
// 	    }
// 		var submitData = {
// 			tid: 440,
// 			/*code: $("#sncode").text(),*/
// 			tel 	: tel,
// 			myname	: myname,
// 			wechaid : wechaid,
// 			lid 	: lid,
// 			prize 	: winprize,
// 			action 	: "add",
// 			idnumber:idnumber
// 		};
// 		$.post('index.php?g=Wap&m=Guajiang&a=add', submitData,
// 			function(data) {
// 				if (data.success == true) {
// 					//alert(data.msg);
// 					//$("#zjl").hide();
// 					window.location.href=window.location.href
// 					//$("#zjl").hide("slow");
// 					return
// 				} else { 
// 					//alert('失败'+data);
// 					return
// 				}
// 			},"json")
// });
$(function(){
    $("#formdata").submit(function(){
        //formdata
        var submitData = $("#formdata").serialize();

        $.post("{pigcms::U('add')}", submitData,function(data) {
            if (data.success == true) {
                window.location.href = window.location.href
                //alert(data.msg);
                //$("#result").hide("slow");
                return
            } else {}
        },
        "json")
        return false;
    })
})
</script>
<div id="tongji_iframe" style="width:1px;height:1px;position:fixed;left:-1000px;"></div>
<script>
    //分享控制
    var WxOptions = {
        //"appid": 'wx78f81724e6590b1d', //服务号appid
        "img_url": "{pigcms::C('site_url')}/<empty name="Guajiang.animpic">{pigcms::RES}/css/guajiang/images/activity-scratch-card-bannerbg.png<else/>{pigcms:$Guajiang.starpicurl}</empty>",//图片
        "img_width": "120",
        "img_height": "120",
        "link": window.location.href.replace(/wecha_id=[^&]*&?/,'fromuser={pigcms:$fromuser}&'),//分享链接
        "title": "{pigcms:$Guajiang.title|addslashes}",//定义分享标题
        "desc": "简介：{pigcms:$Guajiang.desc|addslashes}"//描述
    };
    
    //click统计立即执行
    (function(){
        var tongjiurl = "{pigcms::U('Home/Tongji/click',array('token'=>$token,'pid'=>$Guajiang['lid'],'type'=>'guaguaka','title'=>rawurlencode($Guajiang['title']),'sign'=>md5($Guajiang['token'].$Guajiang['lid'].'guaguaka'.'tongji')))}";
        document.getElementById('tongji_iframe').innerHTML = "<iframe src=\""+tongjiurl+"\"></iframe>";
    })()

    function tongjishare(){
        var tongjiurl = "{pigcms::U('Home/Tongji/share',array('token'=>$token,'pid'=>$Guajiang['lid'],'type'=>'guaguaka','title'=>rawurlencode($Guajiang['title']),'sign'=>md5($Guajiang['token'].$Guajiang['lid'].'guaguaka'.'tongji')))}";
        document.getElementById('tongji_iframe').innerHTML = "<iframe src=\""+tongjiurl+"\"></iframe>";
    }

    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
    	WeixinJSBridge.call('showToolbar');
        WeixinJSBridge.on('menu:share:appmessage', function(argv){
        	tongjishare();
            WeixinJSBridge.invoke('sendAppMessage', WxOptions);
            //share_callback_hy();
            // setTimeout(function () {location.href = "http://mp.weixin.qq.com/s?__biz=MjM5MzgxNTAxMQ==&mid=200063159&idx=8&sn=73d791f479fefb304f3ddf6818c0437a#rd";}, 1500); 
        });
        WeixinJSBridge.on('menu:share:timeline', function(argv){
        	tongjishare();
            WeixinJSBridge.invoke('shareTimeline', WxOptions);
            //share_callback_pyq();
            // setTimeout(function () {location.href = "http://mp.weixin.qq.com/s?__biz=MjM5MzgxNTAxMQ==&mid=200063159&idx=8&sn=73d791f479fefb304f3ddf6818c0437a#rd";}, 1500); 
        });

    });
</script>
</body>
</html>