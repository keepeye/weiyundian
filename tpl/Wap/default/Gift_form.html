<html lang="en">
	<head>
		<meta http-equiv="cache-control" content="no-cache" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title><?=$gift['title'];?>-提交信息-礼品中心</title>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/pure-nr-min.css" />
		<script src="__PUBLIC__/zepto.min.js"></script>
		<style>
			body{background-color:#fff;color:#666;font-size:14px;}
			.content{width: 100%;overflow: hidden;padding-bottom: 40px;}
			input,select{width:100%;}
			.fullbtn{height:3em;line-height:3em;background-color:#0078e7;color:white;text-align: center;text-decoration: none;text-shadow:0 1px 1px rgba(0, 0, 0, 0.2);}
		</style>
	</head>
	<body>
		<div class="content">
			<?php if(empty($sn['formdata'])): ?>
			<form class="pure-form pure-form-stacked" method="post" id='form1'>
				<input type="hidden" name="sn" value="<?=$sn['sn'];?>"/>
				<input type="hidden" name="token" value="<?=$sn['token'];?>"/>
				<input type="hidden" name="wecha_id" value="<?=$sn['wecha_id'];?>"/>
				<fieldset style="padding:5px;">
			        <h3>提交你的个人信息</h3>
					<?php foreach($gift['formset'] as $field): ?>
	                    <?php if($field['type']=='selectfield'): ?>
	                        <?php $options = explode(",",$field['value']);?>
                            <label>{pigcms:$field.name}</label>
                            <select name="formdata[{pigcms:$field.id}]">
                                <?php foreach($options as $option):?>
                                <option value="{pigcms:$option}">{pigcms:$option}</option>
                                <?php endforeach;?>
                            </select>
	                        
	                    <?php else: ?>
	                        <label>{pigcms:$field.name}</label>
	                        <input type="text" name="formdata[{pigcms:$field.id}]" placeholder="{pigcms:$field.name}" value="{pigcms:$field.value}"  />
	                        
	                    <?php endif;?>
	                <?php endforeach;?>
			    </fieldset>
			    <a href="javascript:" class="fullbtn" style="display:block;position:fixed;bottom:0;width:100%;" onclick="form1.submit()">提交</a>
			</form>
			<?php else: ?>
				<div style="margin:5px;">
				<h3>你的领奖信息</h3>
				<p>sn: <?=$sn['sn'];?></p>
				<?php foreach($gift['formset'] as $field): ?>
					<p>
					<script>document.write("<?=$field['name'];?>")</script>:<?=$sn['formdata'][$field['id']];?>
					</p>
				<?php endforeach;?>
				
				<p>
					<h4>领奖指南：</h4>
					<?=$gift['guide'];?>
				</p>
				</div>
				<a href="<?=U('index',array('token'=>$token));?>" class="fullbtn" style="display:block;position:fixed;bottom:0;width:100%;">返回礼品中心</a>
			<?php endif;?>
		</div>
		<script>
			Zepto(function($){
				$("#form1").submit(function(e){
					alert('提交成功');
			    	var checkempty = true;
			    	var checkitem;
			    	//验证字段是否为空
			    	$(this).find("input:text,select").each(function(){
			    		if($(this).val() == ""){
			    			checkitem = $(this);
			    			checkempty = false;
			    			return false;
			    		}
			    	})

			    	if(checkempty == false){
			    		try{
			    			checkitem.after('该字段必填');
			    			checkitem.focus();
			    		}catch(e){

			    		}
			    		e.preventDefault();
			    		return false;
			    	}

			    })
			});

			//微信api
			function onBridgeReady(){
			 	WeixinJSBridge.call('hideOptionMenu');//隐藏分享按钮
			}

			if(typeof WeixinJSBridge == "undefined"){
			    if( document.addEventListener ){
			        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
			    }else if (document.attachEvent){
			        document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
			        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
			    }
			}else{
			    onBridgeReady();
			}
		</script>
	</body>
</html>