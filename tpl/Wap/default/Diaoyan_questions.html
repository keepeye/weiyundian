<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<title>具体内容</title>
<link type="text/css" rel="stylesheet" href="__PUBLIC__/wap/diaoyan/examine.css">
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js"></script>
<script type="text/javascript">
	$(function(){
		//多选事件
		$('.option.multi').click(function(){
			if($(this).attr('sel')=='sel'){
				$(this).find('img').eq(0).show();
				$(this).find('img').eq(1).hide();
				$(this).attr('sel','0');
			}else{
				$(this).find('img').eq(0).hide();
				$(this).find('img').eq(1).show();
				$(this).attr('sel','sel');
			}			
		});
		//单选事件
		$('.option.single').click(function(){
			var others = $(this).siblings();//获取同辈其他元素
			others.each(function(){
				$(this).find('img').eq(0).show();
				$(this).find('img').eq(1).hide();
				$(this).attr('sel','0');
			})
			$(this).find('img').eq(0).hide();
			$(this).find('img').eq(1).show();
			$(this).attr('sel','sel');			
		});		
				
	});
</script>
</head>
<body style="background-color: #ffb100;">
<div class="wrapper">
	<img class="bg" src="__PUBLIC__/wap/diaoyan/bg.jpg">
	<?php if(isset($done)): ?>
		<div class="content-w1">
			<div class="content-w2">
				<div class="content">
					<div class="title">你已经参加过了哦</div>
					<img class="connect" src="__PUBLIC__/wap/diaoyan/connect.png">
					<div class="desc-cont">你可以转发给你的朋友们`(*∩_∩*)′</div>
					
				</div>
			</div>
		</div>
	<?php else: ?>
		<?php $i="1";foreach($tiku_list as $tiku): ?>
		<div class="question" style="overflow:hidden;">
			<div class="title" style="text-align:left">{pigcms:$i}.{pigcms:$tiku.title}</div>
			<if condition="$tiku.type eq '1'">
			<div class="tip1">注：本题可以选择多个答案！</div>
					
			<div class="options" data-value="{pigcms:$tiku.id}">
				<?php foreach($option_list[$tiku['id']] as $option): ?>
				<div class="option multi" data-value="{pigcms:$option.id}">
					<img id="img1" class="oimg" src="__PUBLIC__/wap/diaoyan/option_bg.png">
					<img id="img11" class="oimg-sel" src="__PUBLIC__/wap/diaoyan/option_sel_bg.png">
					<div class="text">
						<div class="otext">{pigcms:$option.value}</div>
					</div>
				</div>
				<?php endforeach;?>
			</div>
			<else/>
			<div class="tip1">注：本题单选！</div>
					
			<div class="options" data-value="{pigcms:$tiku.id}">
				<?php foreach($option_list[$tiku['id']] as $option): ?>
				<div class="option single" data-value="{pigcms:$option.id}">
					<img id="img1" class="oimg" src="__PUBLIC__/wap/diaoyan/option_bg.png">
					<img id="img11" class="oimg-sel" src="__PUBLIC__/wap/diaoyan/option_sel_bg.png">
					<div class="text">
						<div class="otext">{pigcms:$option.value}</div>
					</div>
				</div>
				<?php endforeach;?>
			</div>
			</if>
			
		</div>
		<?php $i++;endforeach;?>
		<div id="submit_btn" class="submit">
			<img src="__PUBLIC__/wap/diaoyan/next_btn.png">
			<span>提交</span>
		</div>
	<?php endif;?>
</div>
<script type="text/javascript">
	$(function(){
		$("#submit_btn").click(function(){
			var checked =true;
			var results = new Array;
			//检测是否有未选题目
			var options_div = $("div.options");
			options_div.each(function(){
				var tiku_id = $(this).attr("data-value");
				if(!tiku_id){
					return true;
				}
				var re=new Array;
				var sel = $(this).find("div.option[sel='sel']");
				sel.each(function(){
					re.push($(this).attr("data-value"))
				})
				if(re.length <= 0){
					alert("请填写完所有题目");
					checked = false;
					return false;
				}
				
				results.push({"tiku_id":tiku_id,"option_ids":re});

			});
			if(!checked || results.length<=0){
				return;
			}


			//将结果提交到后端
			$.ajax({
				url:"{pigcms::U('submit')}",
				data:{"token":"{pigcms:$token}","wecha_id":"{pigcms:$wecha_id}","diaoyan_id":"{pigcms:$diaoyan_id}","results":results},
				type:"post",
				dataType:"json",
				error:function(){
					alert("网络错误，请重试");
				},
				timeout:3000,
				success:function(data){
					if(data.status == "1"){
						$("div.wrapper").html(data.info);
					}else{
						alert(data.info)
					}
				}
			})
		})
	})
</script>
</body>
</html>