<include file="Public:head"/> 
 <link rel="stylesheet" href="{pigcms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{pigcms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{pigcms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{pigcms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{pigcms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script src="{pigcms::STATICS}/lhgcalendar/lhgcalendar.min.js" type="text/javascript"></script>
<script>

var editor = new Array();
var options = {
	resizeType : 1,
	allowPreviewEmoticons : false,
	uploadJson  : "/index.php?m=Image&a=upload",
	items : [
	'source','undo','clearhtml','hr',
	'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
	'insertunorderedlist', '|', 'emoticons', 'image','link', 'unlink','baidumap','lineheight','table','anchor','preview','print','template','code','cut']
}
KindEditor.ready(function(K) {
	editor[0] = K.create('#intro', 	options);
	editor[1] = K.create('#intro1', options);
	editor[2] = K.create('#intro2', options);
	editor[3] = K.create('#intro3', options);
});
</script>
  <div class="content"> 
   <div class="cLineB"> 
    <h4>修改线路</h4> 
    <a href="{pigcms::U('Travel/index',array('token'=>$token))}" class="right  btnGreen" style="margin-top:-27px">返回</a> 
   </div> 
   <form class="form" method="post" action=""> 	
   <input type='hidden' name='id' value='{pigcms:$info.id}'/>
    <div class="msgWrap bgfc"> 
     <table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%"> 
      <tbody> 
       <tr> 
        <th><span class="red">*</span>名称：</th> 
        <td><input type="text" name="title" value="{pigcms:$info.title}" class="px" style="width:400px;" /></td> 
       </tr> 
       <tr>
		<tr> 
        <th><span class="red">*</span>标记：</th> 
        <td><input type='checkbox' name='flag[]' value='h' <if condition="in_array('h',$info['flag'])">checked</if>/>热门 <input type='checkbox' name='flag[]' value='c' <if condition="in_array('c',$info['flag'])">checked</if>/>推荐 </td> 
       </tr>	   
	   <tr> 
        <th><span class="red">*</span>缩略图：</th> 
        <td>
            <img class="upload_image" src="{pigcms:$info.litpic}" style="display: none;max-height: 100px;" />
            <input type="hidden" class="upload_image_filed" id="keyword" value="{pigcms:$info.litpic}" name="litpic" data-thumb="96,66" />
            <input type="button" class="btnGrayS upload_image_button" value="添加图片" data-ishas="false" />
			
        </td>
       </tr>
        <th><span class="red">*</span>线路类型：</th> 
        <td>
			<select name="type">
				<option value="周边游" <if condition="$info.type eq '周边游'">selected</if>>周边游</option>
				<option value="主题游" <if condition="$info.type eq '主题游'">selected</if>>主题游</option>
			</select>
		</td> 
       </tr>
       <tr> 
			<th><span class="red">*</span>出发地点：</th> 
			<td><input type="text" name="start_city" value="{pigcms:$info.start_city}" class="px" style="width:400px;" /></td> 
       </tr>
	   <tr> 
			<th><span class="red">*</span>出发日期：</th> 
			<td>
				<empty name="info['start_date']"><input type="text" name="start_date[]"  class="px" style="width:100px;" value=""/></empty>

				<foreach name="info['start_date']" item="vo">
					<input type="text" name="start_date[]"  class="px" style="width:100px;" value="{pigcms:$vo}"/> 
				</foreach>
				<a href="javascript:void(0)" id="addDateBox">增加日期</a>
				<i>可以手动输入日期，如"天天开团"</i>
			</td> 
       </tr>
	   <tr> 
			<th><span class="red">*</span>行动类型：</th> 
			
			<td>
				<empty name="info['actions']">
				<input type="checkbox" name="actions[]" value="跟团" class="px" /> 跟团 
				<input type="checkbox" name="actions[]" value="自由" class="px" /> 自由
				</empty>

				<foreach name="info['actions']" item="vo1">
					<input type="checkbox" name="actions[]" value="{pigcms:$vo1}" class="px" checked/> {pigcms:$vo1}
				</foreach>
				 
				<a href="javascript:void(0)" id="addRouteType">增加类型</a> 
				<i>类型不够？试试增加类型</i>
			</td> 			
       </tr>
       <tr> 
			<th><span class="red">*</span>原价：</th> 
			<td><input type="text" name="oprice" value="{pigcms:$info.oprice}" class="px" style="width:100px;" /> 元</td> 
       </tr>
        <tr>
			<th><span class="red">*</span>现价：</th>
			<td><input type="text" name="dprice" value="{pigcms:$info.dprice}" class="px" style="width:100px;" /> 元</td> 
		</tr>
		<tr>
			<th><span class="red"></span>幻灯片：</th>
			<td>
				<div id="imgurls">
				<foreach name="info['imgurls']" item="vo2">
					<div><a href='{pigcms:$vo2}' style='width:50px;' title='点击查看大图' target=_blank><img style='margin-bottom:-10px;' src='{pigcms:$vo2}' width='50' height='50'/></a> <input type='text' class='px' style='width:400px;margin-bottom:5px;' name='imgurls[]' value='{pigcms:$vo2}'/> <a href='javascript:' onclick='$(this).parent().remove()'>移除</a></div>
				</foreach>
				</div>
				<input type="button" class="btnGrayS" id='addimg' value="添加" data-ishas="false" />
				建议图片尺寸300*160 左右
			</td>
		</tr>
        <tr>
			<th valign="top">线路特色：</th>
			<td>
			<textarea name="feature" id="intro"  rows="5" style="width:590px;height:360px">{pigcms:$info.feature}</textarea>
			</td>
        </tr>
        <tr>
			<th valign="top">行程安排：</th>
			<td>
			<textarea name="schedule" id="intro1"  rows="5" style="width:590px;height:360px">{pigcms:$info.schedule}</textarea>
			</td>
        </tr>
		<tr>
			<th valign="top">费用说明：</th>
			<td>
			<textarea name="expense" id="intro2"  rows="5" style="width:590px;height:360px">{pigcms:$info.expense}</textarea>
			</td>
        </tr>
		<tr>
			<th valign="top">预定指南：</th>
			<td>
			<textarea name="booking" id="intro3"  rows="5" style="width:590px;height:360px">{pigcms:$info.booking}</textarea>
			</td>
        </tr>
       <tr>         
       <th>&nbsp;</th>
       <td>
       <button type="submit" name="button" class="btnGreen">保存</button></td> 
       </tr> 
      </tbody> 
     </table> 
     </div>
    
   </form> 
  </div> 
  <script>
  $(function(){
	//日期事件
	$("#addDateBox").click(function(){
		var dateBox = "<input type=\"text\" name=\"start_date[]\" value=\"\" class=\"px\" style=\"width:100px;\" /> ";
		$(this).before(dateBox);
		$("input[name='start_date[]']").calendar();
	})
	$("input[name='start_date[]']").calendar();
	
	//线路类型事件
	$("#addAction").click(function(){
		var typename = prompt('请输入线路类型的名字');
		var action = '<input type="checkbox" name="action[]" value="'+typename+'" class="px" /> '+typename+' ';
		$(this).before(action);
	})
	
	KindEditor.ready(function(K){
		//添加幻灯
		var e = K.editor({
			allowFileManager : false,
			uploadJson  : "/index.php?m=Image&a=upload&thumb=300,160",
		});//初始化一个编辑器对象
		var imgurls = $("#imgurls");//imgurl表单的容器
		K('#addimg').click(function() {
			e.loadPlugin('image', function() {
				e.plugin.imageDialog({
					//imageUrl : K('#url1').val(),
					clickFn : function(url, title, width, height, border, align) {
						//K('#url1').val(url);
						var input = "<div><a href='"+url+"' style='width:50px;' title='点击查看大图' target=_blank><img style='margin-bottom:-10px;' src='"+url+"' width='50' height='50'/></a> <input type='text' class='px' style='width:400px;margin-bottom:5px;' name='imgurls[]' value='"+url+"'/> <a href='javascript:' onclick='$(this).parent().remove()'>移除</a></div>";
						imgurls.append(input);
						e.hideDialog();
					}
				});
			});
		});
		//缩略图
		var e1 = K.editor({
			allowFileManager : false,
			uploadJson  : "/index.php?m=Image&a=upload&litpic=1",
		});//初始化一个编辑器对象
		var imgurls = $("#imgurls");//imgurl表单的容器
		K('#upLitPic').click(function() {
			e1.loadPlugin('image', function() {
				e1.plugin.imageDialog({
					//imageUrl : K('#url1').val(),
					clickFn : function(url, title, width, height, border, align) {
						//K('#url1').val(url);
						$("#litpic").val(url);
						$("#litpic_preview").attr('src',url);
						e1.hideDialog();
					}
				});
			});
		});

	})
  })
  </script>
  <include file="Public:footer" />
