<include file="Public:head"/>
 <div class="content">
<div class="cLineB"><h4>添加菜单</h4><a href="javascript:history.go(-1);" class="right btnGrayS vm" style="margin-top:-27px">返回</a></div>


<div class="clr"></div>
 <div class="msgWrap"> 
<style>
.btnGreen {border:1px solid #288fc9;/*box-shadow:0 1px 1px #aaa;-moz-box-shadow:0 1px 1px #aaa;-webkit-box-shadow:0 1px 1px #aaa;*/padding:3px 10px;cursor:pointer;display:inline-block;text-align:center;vertical-align:bottom;overflow:visible;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;*zoom:1;background-color:#42a5d9;background-image:linear-gradient(bottom, #42a5d9 3%, #44afde 97%, #fff 100%);background-image:-moz-linear-gradient(bottom, #42a5d9 3%, #44afde 97%, #fff 100%);background-image:-webkit-linear-gradient(bottom, #42a5d9 3%, #44afde 97%, #fff 100%);color:#fff;font-size:12px;line-height: 1.5;}
.btnGreen:hover {background-color:#47a7de;background-image:linear-gradient(bottom, #2774a0 3%, #47a7de 97%, #fff 100%);background-image:-moz-linear-gradient(bottom, #2774a0 3%, #47a7de 97%, #fff 100%);background-image:-webkit-linear-gradient(bottom, #2774a0 3%, #47a7de 97%, #fff 100%);color:#fff}
.btnGreen:active {background-color:#2774a0;background-image:linear-gradient(bottom, #47a7de 3%, #2774a0 97%, #fff 100%);background-image:-moz-linear-gradient(bottom, #47a7de 3%, #2774a0 97%, #fff 100%);background-image:-webkit-linear-gradient(bottom, #47a7de 3%, #2774a0 97%, #fff 100%);color:#fff}

.txt{border: 1px solid #a8adb6;padding: 5px;line-height: 1.5;background-color: #ffffff;border-radius: 2px 2px 2px 2px;width: 300px;}
</style>

	<form action="" method="post" id="realinfo_form">
	<table border="0" cellpadding="0" cellspacing="0" width="100%">
		<tbody>
		<tr>
			<td align="right" height="42" width="">父级菜单：</td>
			<td>
				<div class="mr15 l">
				<select name="pid" id="pid">
					<option selected="selected" value="0">请选择菜单</option>
					<volist id="class" name="class">
						<option  value="{pigcms:$class.id}">{pigcms:$class.title}</option>
					</volist>
				</select>
				</div>
			</td>
		</tr>
		<tr>
			<td align="right" height="42" width="">主菜单名称：</td>
	  <td>
				<div class="mr15 l">
				<input id="menu_title" class="txt" name="title" title="主菜单名称" value="" type="text"> 1级菜单最多4个汉字 2级菜单最多7个汉字</div>
				<div class="system l"></div>
			</td>
		</tr>					
		<tr>
			<td align="right" height="42" width="">触发回复关键词：</td>
			<td>
				<div class="mr15 l">
					<select id="menu_key_module">
						<option value="0">--模块--</option>
						<option value="首页" data-default="true">首页</option>
                        <option value="主页" data-default="true">主页</option>
						<option value="帮助" data-default="true">帮助</option>
						<option value="会员卡" data-default="true">会员卡</option>
						<option value="相册" data-default="true">相册</option>
						
						<option disabled>--房产模块--</option>
						<option value="房产" data-default="true">房产</option>
						<option value="户型" data-default="true">户型</option>
						<option value="房友印象" data-default="true">房友印象</option>
						<option disabled>--商城模块--</option>
						<option value="商城" data-default="true">商城</option>
						<option disabled>--旅游模块--</option>
						<option value="旅游线路" data-default="true">旅游线路</option>
						<option disabled>--汽车模块--</option>
						<option value="4s服务" data-default="true">4s服务</option>
						<option disabled>--文章列表--</option>
						<foreach name='kmodules' item='v'>
						<option value="{pigcms::$key}">{pigcms:$v}</option>
						</foreach>
					</select>
					
                    <select id="menu_key" >
						<option value="">请选择关键词</option>
                    </select>
					<input type="text" class='px' name='keyword' /> 这里可以自定义关键词
                </div>
				<div class="system l"></div>
			</td>
		</tr>
		<tr>
			<td align="right" style="vertical-align: top;">外链接url：</td>
			<td>
                <input type="hidden" name="url" />
                <select id="types">
                    <option value="0">请选择类型</option>
					  <option value="input">输入网址</option>
					  <option value="location">我的位置(地图)</option>
					  <option value="photos">3G相册</option>
					  <option value="tel">电话拨号</option>
                </select>
                <div id="item_list" style="margin-top: 10px;">
                    <input type="input" class="px" placeholder="http://" onchange="update_value(this);" style="width: 300px;"/>
                </div>
                <script type="text/javascript">
				
					
					
						function update_value(ob){
							$("input[name=url]").val($(ob).val());
						}

						  $("#types").change(function(){
							  var type=$(this).val();
							  if(type=="input"){
								
								$("#item_list").html('<input type="input" class="px" placeholder="http://" onkeyup="update_value(this);" style="width: 300px;"/>');
							  }else if(type=="tel"){
								
								$("#item_list").html('<input type="input" class="px" placeholder="" value="tel:{pigcms:$company.tel}" readonly style="width: 300px;"/>');
								$("input[name=url]").val("tel:{pigcms:$company.tel}");
							  }else if(type=="location"){
								
								var apiurl = "http://api.map.baidu.com/marker?location={pigcms:$company.latitude},{pigcms:$company.longitude}&title={pigcms:$company.name|rawurlencode}&content={pigcms:$company.name|rawurlencode}&output=html";
								$("#item_list").html('<input type="input" class="px" placeholder="" value="'+apiurl+'" style="width: 300px;" readonly/>');
								$("input[name=url]").val(apiurl);
							  }else{
								
								  $.get("/index.php?g=User&m=Classify&a=itemlist",{"type":type},function(data){
									  if(data.error==0 && data.data.length>0){
										  var html='<select onchange="update_value(this);">';
										  for(d in data.data){
											  html+='<option value="'+data.data[d].url+'">'+data.data[d].name+'</option>';
										  }
										  html+='</select>';
										  $("#item_list").html(html);
										  $("input[name=url]").val(data.data[0].url);
										  
									  }
									  else{
										  $("#item_list").html('<input type="input" class="px" placeholder="http://" onkeyup="update_value(this);" style="width: 300px;"/>');
										  
									  }
								  },"json");
							  }
						  });
						  //关键词列表ajax
						  $(function(){
							function updatekeyword(){
								var val = $("#menu_key").find("option:selected").eq(0).attr('value');
								//alert(val)
								$("input[name='keyword']").val(val)
							}
							
							$("#menu_key_module").change(function(){
								//外链复位
								$("input[name=url]").val("");
								$("#item_list").html('<input type="input" class="px" placeholder="http://" onkeyup="update_value(this);" style="width: 300px;"/>');
								//
								var module = $(this).val();//select的value,当作模块名
								
								//不选择
								if(module == 0){
									$("#menu_key").html("<option value=''>请选择关键词</option>");
									return;
								}
								//几个固定关键词
								var selected_option = $(this).find("option:selected").eq(0);
								var selected_option_value = selected_option.attr('value');
								
								if(selected_option.attr('data-default') == "true"){
									$("#menu_key").html("<option value='"+selected_option_value+"'>"+selected_option_value+"</option>");
									$("input[name='keyword']").val(module);//直接设置关键词的值
									return;
								}
								
								//根据模块拉取关键词列表
								$.ajax({
									url:"{pigcms::U('ajaxKeywordList')}",
									data:{"mname":module},
									type:"POST",
									dataType:"json",
									error:function(){alert('网络错误，请重试')},
									success:function(data){
										if(data.status == "1"){
											$("#menu_key").html("");
											if(data.data != null){
												$("#menu_key").html("<option value=''>---空---</option>");
												$.each(data.data,function(i,val){
													$("#menu_key").append("<option value='"+val.keyword+"'>"+val.keyword+"</option>");
												})
											}else{
												$("#menu_key").html("<option value=''>无关键词</option>");
											}
										}else{
											alert('读取错误，请联系管理员');
										}
									}
								})
								//updatekeyword();//更新keyword表单
							})
							
							$("#menu_key").change(function(){
								updatekeyword();
								$("input[name=url]").val("");
								$("#item_list").html('<input type="input" class="px" placeholder="http://" onkeyup="update_value(this);" style="width: 300px;"/>');
							})
						  })
                </script>
			</td>
		</tr>
		<tr>
			<td align="right" height="42">显示：</td>
			<td>
				<div class="mr15 l">
				<input type="radio" name="is_show" checked="checked" value="1">是&nbsp;
				<input type="radio" name="is_show"  value="0">否&nbsp;
				</div>
				<div class="system l"></div>
			</td>
		</tr>
		<tr>
			<td align="right" height="42">排序：</td>
			<td>
				<div class="mr15 l">
				<input id="sortid" class="txt" name="sort" title="排序" value="" type="text" style="width: 20px;"></div>
				<div class="system l"></div>
			</td>
		</tr>
		<tr>
			<td height="42">&nbsp;</td>
			<td>
				<input class="btnGreen" type="submit" name="submit" value="提交">
			</td>
		</tr>
			
	</tbody></table>
</form>
</div>
</div>
<div class="clr"></div>
<include file="Public:footer"/>
